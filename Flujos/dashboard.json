[
    {
        "id": "1bc6f5434c4f46b9",
        "type": "group",
        "z": "22f47a5db36d7b78",
        "g": "b17494c958703951",
        "name": "Panel 3D Printer",
        "style": {
            "stroke": "#00bcd4",
            "fill": "#e0f7fa",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "dbd8980e1a6d3396",
            "63ae94fc7184a028"
        ],
        "x": 374,
        "y": 1639,
        "w": 612,
        "h": 82
    },
    {
        "id": "dbd8980e1a6d3396",
        "type": "function",
        "z": "22f47a5db36d7b78",
        "g": "1bc6f5434c4f46b9",
        "name": "Unificar datos printer + imagen",
        "func": "// Asume msg.payload contiene todos los datos del printer\nlet d = msg.payload;\n\n// Formatear tiempo\nlet secs = parseInt(d.printTime.elapsed.value || 0);\nlet h = Math.floor(secs / 3600);\nlet m = Math.floor((secs % 3600) / 60);\nlet s = secs % 60;\nlet elapsed = `${h}h ${m}m ${s}s`;\n\n// Formatear estado\nlet status = d.status.value.toUpperCase();\nlet color = \"#999\";\nif (status === \"PRINTING\") color = \"#42a5f5\";\nelse if (status === \"PAUSED\") color = \"#ffb74d\";\nelse if (status === \"DONE\") color = \"#81c784\";\n\n// Salida\nmsg.payload = {\n  file: d.file.value,\n  status: status,\n  statusColor: color,\n  elapsed: elapsed,\n  progress: d.progress.value,\n  temps: {\n    room: d.environment.roomTemperature.value.toFixed(1) + \" °C\",\n    bed: d.temperatures.bed.actual.value.toFixed(1) + \" °C\",\n    nozzle: d.temperatures.nozzle.actual.value.toFixed(1) + \" °C\",\n    nozzleTarget: d.temperatures.nozzle.target.value.toFixed(1) + \" °C\"\n  },\n  image: d.image?.value || \"\"\n};\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 1680,
        "wires": [
            [
                "63ae94fc7184a028"
            ]
        ]
    },
    {
        "id": "63ae94fc7184a028",
        "type": "ui_template",
        "z": "22f47a5db36d7b78",
        "g": "1bc6f5434c4f46b9",
        "group": "fd718569531f6881",
        "name": "Panel Dashboard Printer",
        "order": 1,
        "width": "12",
        "height": "10",
        "format": "<style> \n  .card-container {\n    font-family: 'Segoe UI', sans-serif;\n    background-color: #f0f0f0;\n    padding: 20px;\n    border-radius: 12px;\n    color: #90caf9;\n\n    display: flex;\n    gap: 30px;\n  }\n\n  .headline {\n    color: #1e88e5;\n    border-bottom: 2px solid #555;\n    padding-bottom: 5px;\n    margin-bottom: 15px;\n    font-size: 22px;\n    text-transform: uppercase;\n    font-weight: bold;\n    text-align: center; /* ✅ Añade esta línea */\n    background-color: transparent;\n    /* Asegura fondo transparente */\n  }\n\n  /* Barra más larga SOLO para Temperaturas */\n  .temps .headline {\n    width: 140%;                     /* barra más larga (puedes ajustar %) */\n  }\n\n  /* Párrafos dentro de .status-info y .temps */\n  .status-info p,\n  .temps p {\n    font-size: 20px;\n    margin: 10px 0;\n    color: #1e88e5;\n    font-weight: normal;\n    background-color: transparent !important;\n  }\n\n  /* Para que strong no tenga fondo */\n  .status-info strong,\n  .temps strong {\n    font-weight: normal;\n    color: #1e88e5;\n    text-transform: uppercase;\n    background-color: transparent !important;\n  }\n\n  .progress-container {\n    width: 100%;\n    background: #ccc;\n    border-radius: 8px;\n    position: relative;\n    height: 30px;\n    margin-top: 5px;\n  }\n\n  .progress-bar {\n    height: 100%;\n    border-radius: 8px;\n    transition: width 0.5s;\n    background: linear-gradient(90deg, #4f83cc, #b39ddb);\n  }\n\n  .progress-text {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    text-align: center;\n    line-height: 30px;\n    font-weight: bold;\n    color: #ffffff;\n    background-color: transparent !important;\n  }\n\n  .temps p.bed {\n    display: block !important;\n  }\n  .status-info p.tiempo {\n    display: block !important;\n  }\n\n  .camera {\n    /* Foto 1/3 del contenedor */\n    flex: 0 0 33.33%; /* fijo un tercio del ancho */\n  }\n\n  .camera img {\n    width: 100%;\n    height: auto;\n    max-height: 400px; /* más alto para que se note grande */\n    border-radius: 10px;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);\n    object-fit: cover;\n    background-color: transparent !important;\n  }\n\n  .camera .no-image {\n    color: #bbb;\n    font-style: italic;\n    background-color: transparent !important;\n  }\n</style>\n\n<div class=\"card-container\" layout=\"row\" layout-align=\"space-between start\">\n  <!-- Estado -->\n  <div flex=\"40\" class=\"status-info\">\n    <div class=\"headline\">Estado</div>\n    <p><strong>Archivo:</strong> {{msg.payload.file}}</p>\n    <p><strong>Estado:</strong>\n      <span style=\"color: {{msg.payload.statusColor}};\">\n        {{msg.payload.status}}\n      </span>\n    </p>\n    <p class=\"tiempo\"><strong>Tiempo:</strong><br>{{msg.payload.elapsed}}</p>\n    <p><strong>Progreso:</strong></p>\n    <div class=\"progress-container\">\n      <div class=\"progress-bar\" style=\"width: {{msg.payload.progress}}%;\"></div>\n      <div class=\"progress-text\">{{msg.payload.progress}}%</div>\n    </div>\n  </div>\n\n  <!-- Temperaturas -->\n  <div flex=\"20\" class=\"temps\">\n    <div class=\"headline\">Temperaturas</div>\n    <p><strong>Habitación:</strong> {{msg.payload.temps.room}}</p>\n    <p class=\"bed\"><strong>Bed:</strong><br>{{msg.payload.temps.bed}}</p>\n    <p><strong>Nozzle:</strong> {{msg.payload.temps.nozzle}}</p>\n    <p><strong>Target:</strong> {{msg.payload.temps.nozzleTarget}}</p>\n  </div>\n\n  <div flex=\"100\"></div>\n  <!-- Cámara -->\n  <div class=\"camera\">\n    <div class=\"headline\">Cámara</div>\n    <img ng-if=\"msg.payload.image\" ng-src=\"data:image/jpeg;base64,{{msg.payload.image}}\">\n    <div ng-if=\"!msg.payload.image\" class=\"no-image\">Sin imagen disponible</div>\n  </div>\n</div>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 850,
        "y": 1680,
        "wires": [
            []
        ]
    },
    {
        "id": "fd718569531f6881",
        "type": "ui_group",
        "name": "Visual",
        "tab": "42e453982dc44df4",
        "order": 2,
        "disp": true,
        "width": "12",
        "collapse": false,
        "className": ""
    },
    {
        "id": "42e453982dc44df4",
        "type": "ui_tab",
        "name": "Dashboard",
        "icon": "dashboard",
        "order": 1
    }
]